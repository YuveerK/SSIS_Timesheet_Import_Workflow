name: Deploy SSIS Project

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: [self-hosted, windows]

    env:
      ISPAC_PATH: "C:\\dev_zone\\SSIS_Timesheet_Import_Workflow\\Normalized_SSIS_Project.ispac"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run DB init + ISPAC deploy
        shell: pwsh
        run: |
          $sql = @"
          :setvar IspacFullPath "$env:ISPAC_PATH"
          :r scripts/create-db-and-tables.sql
          "@
          $sql | Out-File -FilePath temp-deploy.sql -Encoding ASCII
          
          sqlcmd -S YUVEER -U Auto_User_2 -P "Test@1234" -i temp-deploy.sql
